---
name: review
description: 설계 문서, ERD, 시퀀스 다이어그램, API 설계, 코드 구현에 대한 리뷰를 수행한다. 구현 완료 후 자동 리뷰, 또는 수동 호출로 사용. 실무 관점에서 문제점을 찾고 개선안을 제시하며, 면접에서 설명할 수 있는 기술적 의사결정 포인트를 짚어준다.
---

# Design & Code Review Skill

> 이 스킬은 구현된 결과물을 실무 시니어 개발자 관점에서 리뷰한다.
> 리뷰어는 칭찬보다 **구체적인 문제점과 개선안**에 집중한다.
> 모든 피드백에는 **왜 문제인지(근거)**와 **어떻게 고치는지(액션)**를 포함한다.

## 리뷰 원칙

1. **이 프로젝트의 맥락을 먼저 파악한다**
   - 개인 블로그 백엔드, 단일 사용자, 대용량 아님
   - Java 21 / Spring Boot 4.0 / MySQL / Redis
   - 과도한 설계(오버엔지니어링)를 경계한다
   - "실무에서 이렇게 한다더라"가 아니라 "이 프로젝트에서 이게 맞는가"를 따진다

2. **트레이드오프를 명시한다**
   - "A가 좋다"가 아니라 "A를 선택하면 X를 얻고 Y를 잃는다"
   - 최종 결정은 개발자에게 맡긴다

3. **면접 관점을 포함한다**
   - "이 설계를 면접에서 질문받으면 어떻게 답할 수 있는가"
   - 기술적 의사결정의 근거를 설명할 수 있게 돕는다

## 리뷰 대상별 체크리스트

### 1. ERD / 테이블 설계 리뷰

ERD나 엔티티 설계를 발견하면 아래를 순서대로 점검한다:

**정규화 & 반정규화**
- 불필요한 중복 컬럼이 있는가?
- 반정규화를 했다면 근거가 있는가? (조회 성능 등)
- 이 프로젝트 규모에서 반정규화가 필요한 상황인가?

**관계 설정**
- FK 제약조건: 이 프로젝트는 개인 블로그이므로 FK를 건다 (무결성 우선)
- JPA 연관관계: 단방향 @ManyToOne(fetch=LAZY)만 허용, 양방향/@OneToMany 금지
- cascade 설정이 있으면 경고 — 이 프로젝트에서는 cascade 사용 금지

**인덱스**
- 조회 조건으로 자주 쓰이는 컬럼에 인덱스가 있는가?
- slug, category_id, post_id 등 WHERE/JOIN 대상 컬럼 확인
- 복합 인덱스가 필요한 쿼리 패턴이 있는가?

**Redis 키 설계**
- 키 네이밍이 일관적인가? (콜론 구분자)
- TTL 정책이 명시되어 있는가?
- 메모리 무한 증가 가능성이 있는 구조인가? (예: Set에 데이터가 계속 쌓이는 경우)
- KEYS 명령어를 사용하고 있다면 경고 — SCAN 또는 별도 Set으로 관리

**출력 형식**
```
## ERD 리뷰 결과

### 양호
- (양호한 부분 간단히)

### 검토 필요
- **[항목]**: 현재 상태 → 문제점 → 개선안 → 트레이드오프

### 면접 포인트
- "왜 FK를 걸었는가?" → (이 프로젝트에서의 근거)
- "왜 양방향 매핑을 안 했는가?" → (근거)
```

### 2. 시퀀스 다이어그램 리뷰

시퀀스 다이어그램이나 API 흐름 설계를 발견하면 아래를 점검한다:

**흐름의 정확성**
- 실제 Spring 구조와 일치하는가? (SecurityFilter vs Controller 역할 구분)
- 요청-응답 흐름에서 빠진 단계가 있는가?
- 에러 케이스가 충분히 표현되어 있는가?

**도메인 간 의존성**
- Service A가 Service B를 직접 호출하고 있는가?
- 순환 의존이 생길 가능성이 있는가?
- 이벤트 기반으로 분리하면 좋을 부분이 있는가? (단, 이 프로젝트 규모에서 필요한가 먼저 판단)

**비동기 처리**
- 비동기로 표시된 부분이 실제로 비동기여야 하는가?
- 비동기 실패 시 처리 전략이 있는가? (재시도? 무시? 로깅?)

**API 설계**
- RESTful 컨벤션을 따르는가? (복수형, 올바른 HTTP 메서드)
- 빠진 API가 있는가? (CRUD 중 하나가 빠졌거나, 조회 API 누락 등)
- 인증 필요/불필요 구분이 적절한가?

**실무 이슈**
- Redis에서 위험한 명령어(KEYS, FLUSHALL 등)를 사용하고 있는가?
- N+1 쿼리가 발생할 수 있는 구간이 있는가?
- 동시성 이슈가 발생할 수 있는 구간이 있는가?

**출력 형식**
```
## 시퀀스 다이어그램 리뷰 결과

### 양호
- (양호한 부분)

### 검토 필요
- **[흐름 번호/이름]**: 현재 → 문제점 → 개선안

### 수정 필요
- **[흐름 번호/이름]**: 현재 → 왜 틀렸는지 → 수정 방법

### 누락된 항목
- (빠진 API, 빠진 에러 처리 등)

### 면접 포인트
- (설계 의사결정을 설명할 수 있는 질문-답변 쌍)
```

### 3. 코드 구현 리뷰

코드 파일을 리뷰할 때 아래를 점검한다:

**아키텍처 준수**
- 레이어 규칙을 지키고 있는가? (Controller에 비즈니스 로직 없는지)
- Entity를 API 응답으로 직접 반환하고 있지 않은가?
- DTO 변환이 적절한가?

**엔티티 설계**
- @Setter 사용 여부 → 사용하고 있으면 경고
- 양방향 매핑 사용 여부 → 사용하고 있으면 경고
- cascade 사용 여부 → 사용하고 있으면 경고
- BaseEntity(createdAt, updatedAt) 상속 여부
- 의미 있는 비즈니스 메서드로 상태 변경하는가? (setter 대신)

**예외 처리**
- 커스텀 예외를 사용하고 있는가?
- ErrorCode enum과 연결되어 있는가?
- catch (Exception e)로 뭉뚱그리고 있지 않은가?

**보안**
- 인증이 필요한 API에 적절한 권한 체크가 있는가?
- API 키, 비밀번호 등이 코드에 하드코딩되어 있지 않은가?
- SQL Injection 가능성이 있는가? (JPA 사용 시 거의 없지만 native query 확인)

**성능**
- N+1 쿼리 가능성이 있는가?
- 불필요한 전체 조회(findAll)가 있는가?
- 페이징이 필요한 곳에 페이징이 있는가?
- Redis 호출 횟수가 과도하지 않은가?

**테스트 용이성**
- 테스트하기 어려운 구조가 있는가? (static 메서드 의존, new로 직접 생성 등)
- 외부 의존성이 인터페이스로 추상화되어 있는가? (AI Client, FileStorage 등)

**코드 품질**
- 메서드가 너무 길지 않은가? (30줄 이상이면 분리 검토)
- 네이밍이 의도를 드러내는가?
- 매직 넘버/매직 스트링이 있는가?
- 불필요한 주석이 있는가? (코드로 의도가 드러나야 함)

**출력 형식**
```
## 코드 리뷰 결과: {파일명}

### 양호
- (잘 된 부분)

### 개선 권장
- **[라인 번호]**: 현재 코드 → 문제점 → 개선 코드

### 수정 필요
- **[라인 번호]**: 현재 코드 → 왜 문제인지 → 수정 코드

### 면접 포인트
- "왜 이렇게 구현했는가?" 질문에 대한 답변 준비
```

### 4. 테스트 코드 리뷰

테스트 코드를 리뷰할 때 아래를 점검한다:

**가치 판단**
- 이 테스트가 존재할 가치가 있는가? (커버리지를 위한 무의미한 테스트가 아닌가)
- 핵심 비즈니스 로직을 검증하고 있는가?

**테스트 종류 적합성**
- 도메인 정책 → 단위 테스트로 작성되어 있는가?
- 유스케이스 → 통합/인수 테스트로 작성되어 있는가?
- 단순 CRUD에 대한 불필요한 단위 테스트가 있지 않은가?

**테스트 품질**
- given-when-then 구조를 따르고 있는가?
- 한 테스트에서 한 가지만 검증하는가?
- 테스트명이 한글로 정책/시나리오를 서술하는가?
- 모의 객체를 과도하게 사용하고 있지 않은가?
- 경계 값 테스트가 포함되어 있는가?

**FIRST 규칙**
- Fast: 느린 테스트가 있는가?
- Independent: 테스트 간 의존성이 있는가?
- Repeatable: 시간이나 랜덤에 의존하는 테스트가 있는가?
- Self-Validating: 수동 확인이 필요한 테스트가 있는가?

## 리뷰 실행 방법

이 스킬은 두 가지 방식으로 호출할 수 있다:

### 수동 호출
```
/review ERD 리뷰해줘
/review 시퀀스 다이어그램 리뷰해줘
/review PostService.java 코드 리뷰해줘
/review 테스트 코드 리뷰해줘
```

### 구현 후 자동 리뷰 (api-dev 스킬과 연계)
구현이 완료되면 자동으로 이 리뷰 스킬을 실행하여 피드백을 제공한다.
구현 에이전트에게 다음과 같이 지시할 수 있다:
```
API 구현 끝나면 /review로 코드 리뷰까지 돌려줘
```

## 리뷰 후 행동 규칙

1. **수정 필요** 항목은 즉시 수정 코드를 제안한다
2. **검토 필요** 항목은 트레이드오프를 설명하고 개발자에게 선택을 맡긴다
3. 리뷰 결과를 반복해서 설명하지 않는다 — 한 번 명확하게 전달하고 끝낸다
4. "잘했어요", "좋습니다" 같은 빈 칭찬은 하지 않는다
